import os
import zlib
from os import listdir, path

PATH = "E:\MalwareDataset\sophos\compressed_malware"

folders = listdir(PATH)
exl = ["_".join(i.split("_")[1:]) for i in listdir("E:\MalwareDataset\sophos\decompressed_malware")]

for folder in folders:

    if folder in exl:
        continue

    idx = 0

    files = listdir(path.join(PATH, folder))

    for file in files:


        compressed_data = open(path.join(PATH, folder, file), 'rb')
        decompressed_data = zlib.decompress(compressed_data.read())
        out_path = f"E:\MalwareDataset\sophos\decompressed_malware\decompressed_{folder}"
        if not path.exists(out_path):
            os.mkdir(out_path)
        decompressed = open(path.join(out_path, file), 'wb')
        decompressed.write(decompressed_data)
        compressed_data.close()
        decompressed.close()

        idx += 1



    print(f"{idx} files decompressed from {folder}")
